@model GAppsDev.Models.UserModels.AllUsersModel

@{
    ViewBag.Title = "ניהול משתמשים";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section ExtraScripts{
    <script src="~/Scripts/SearchScript.js"></script>
}

@section featured {
    <section class="featured">
        <div class="content-wrapper">
            <hgroup class="title">
                <h1>@ViewBag.Title</h1>
            </hgroup>
        </div>
    </section>
}

<fieldset id="userLimit">
    <legend>כמות משתמשים</legend>

    <span>כל המשתמשים: @Model.UsersCount</span><br />
    <span>מכסת משתמשים: @Model.UsersLimit</span><br />
    <span>משתמשים מבוטלים: @Model.NonActiveUsers.Count</span>
</fieldset>

@Html.Action("SearchForm", new { isExpanding = true, isCollapsed= true })

<p>
    @Html.ActionLink("הוסף משתמש חדש", "Create")
</p>

<h2>משתמשים פעילים (@Model.ActiveUsers.Count)</h2>
@if (Model.ActiveUsers.Count() != 0)
{ 
    @Html.Action("List", new { users = Model.ActiveUsers, baseUrl = Url.Action("Index"), isOrdered = true, isPaged = true, sortby = (string)ViewBag.Sortby, order = (string)ViewBag.Order, currPage = (int)ViewBag.CurrPage, NumberOfPages = (int)ViewBag.NumberOfPages })
}
else
{
    <span class="no-properties">לא נמצאו משתמשים פעילים</span> 
}

<h2>משתמשים חדשים (@Model.PendingUsers.Count)</h2>
@if(Model.PendingUsers.Count > 0)
{
    <table>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.PendingUsers[0].Email)
            </th>
        
            <th>
                @Html.DisplayNameFor(model => model.PendingUsers[0].Roles)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.PendingUsers[0].CreationDate)
            </th>
            <th>פעולות</th>
        </tr>

    @foreach (var user in Model.PendingUsers) {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => user.Email)
            </td>
            <td>
                @{ 
                    string roles = ((DA.RoleType)user.Roles).ToString();
                    <text> @roles </text>
                 }
            </td>
            <td>
                @Html.DisplayFor(modelItem => user.CreationDate)
            </td>
            <td>
                @Html.ActionLink("ערוך", "EditPending", new { id=user.Id }) |
                @Html.ActionLink("מחק", "DeletePending", new { id=user.Id })
            </td>
        </tr>
    }

    </table>
}
else
{
    <div>
        <span>לא נמצאו משתמשים חדשים.</span>
    </div>
}


<h2>משתמשים שבוטלו (@Model.NonActiveUsers.Count)</h2>
@if (Model.NonActiveUsers.Count > 0)
{
    <table>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.NonActiveUsers[0].Company.Name)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.NonActiveUsers[0].FirstName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.NonActiveUsers[0].LastName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.NonActiveUsers[0].Roles)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.NonActiveUsers[0].CreationTime)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.NonActiveUsers[0].LastLogInTime)
            </th>
            <th>פעולות</th>
        </tr>

    @foreach (var user in Model.NonActiveUsers)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => user.Email)
            </td>
            <td>
                @Html.DisplayFor(modelItem => user.FirstName)
            </td>
            <td>
                @Html.DisplayFor(modelItem => user.LastName)
            </td>
            <td>
                @{ 
                    string roles = ((DA.RoleType)user.Roles).ToString();
                    <text> @roles </text>
                 }
            </td>
            <td>
                @Html.DisplayFor(modelItem => user.CreationTime)
            </td>
            <td>
                @Html.DisplayFor(modelItem => user.LastLogInTime)
            </td>
            <td>
                @Html.ActionLink("החזר משתמש", "UndoDelete", new { id=user.Id })
            </td>
        </tr>
    }

    </table>
}
else
{
    <div>
        <span>לא נמצאו משתמשים שבוטלו.</span>
    </div>
}